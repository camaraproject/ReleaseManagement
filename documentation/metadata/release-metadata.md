# The `release-metadata.yaml` File

This document explains the generated `release-metadata.yaml` file and how it is used.

---

## Purpose

The `release-metadata.yaml` file is the **authoritative record** of a release:

- Records the exact parameters of a release attempt
- Captures the source commit SHA
- Contains calculated API versions with extensions
- Provides resolved dependency information

This file answers: "What was actually released, and from what source?"

---

## Generation

### When it is created

`release-metadata.yaml` is generated automatically when a snapshot is created:

1. Maintainer triggers snapshot creation
2. Automation validates the current state
3. If validation passes, the snapshot branch is created
4. `release-metadata.yaml` is generated and committed to the snapshot branch

### What generates it

Release automation derives all values from:

- The `release-plan.yaml` on `main` at the snapshot creation time
- The repository state at the snapshot source commit
- Calculated values (version extensions, resolved dependencies)

### Where it lives

| Location | Status |
|----------|--------|
| Snapshot branch | Created during snapshot |
| Release tag | Preserved permanently |

The file is never present on `main`. It exists only on snapshot branches and in release tags.

---

## Structure overview

```yaml
repository:
  repository_name: DeviceLocation
  release_tag: r4.1
  release_type: pre-release-rc
  release_date: 2026-01-17T14:30:00Z
  src_commit_sha: abcd1234efgh5678ijkl9012mnop3456qrst7890
  release_notes: Pre-release for CAMARA Fall26 release cycle.

dependencies:
  commonalities_release: "r4.2 (1.2.0-rc.1)"
  identity_consent_management_release: "r4.3 (1.1.0)"

apis:
  - api_name: location-verification
    api_version: 3.2.0-rc.2
    api_title: "Location Verification"

  - api_name: location-retrieval
    api_version: 0.5.0-alpha.1
    api_title: "Location Retrieval"
```

---

## Key fields

### `src_commit_sha`

The full SHA of the commit on `main` (or maintenance branch) from which the snapshot was created.

This is critical for:
- **Reproducibility** — knowing exactly what code was released
- **Auditing** — tracing a release back to its source
- **Comparison** — understanding what changed between releases

### `release_date`

The timestamp when the draft release was created. Set at draft creation time (after Release PR merge), not at publication.

### `api_version` (with extension)

The complete API version including any pre-release extension:

| Declared in plan | Generated in metadata |
|------------------|----------------------|
| `3.2.0` with status `rc` | `3.2.0-rc.2` |
| `0.5.0` with status `alpha` | `0.5.0-alpha.1` |

The extension number (e.g., `-rc.2`) is calculated automatically based on previous releases.

### `dependencies` (resolved)

Dependencies include both the release tag and the resolved documentation version:

```yaml
commonalities_release: "r4.2 (1.2.0-rc.1)"
```

This captures the exact state of dependencies at release time.

---

## Relationship to snapshots and tags

```
main branch
    │
    ├── release-plan.yaml (intent)
    │
    ▼
Snapshot creation
    │
    ├── release-snapshot/r4.1-abc1234 branch
    │       │
    │       └── release-metadata.yaml (generated)
    │
    ▼
Publication
    │
    └── r4.1 tag
            │
            └── release-metadata.yaml (preserved)
```

The file is:
- **Generated** on the snapshot branch during snapshot creation
- **Preserved** in the release tag after publication

---

## Use for reporting and audit

### Cross-repository visibility

`release-metadata.yaml` enables automated reporting across repositories:

- List all releases and their API versions
- Track dependency relationships
- Generate meta-release overviews

### Audit trail

Every release is traceable:

| Question | Answer from |
|----------|-------------|
| What commit was released? | `src_commit_sha` |
| When was it released? | `release_date` |
| What APIs were included? | `apis` array |
| What dependencies were used? | `dependencies` |

### Release comparison

Comparing `release-metadata.yaml` across releases shows:

- Which API versions changed
- Which dependencies were updated
- The time between releases

---

## What you should not do

### Do not edit this file

`release-metadata.yaml` is automation-generated. If values are wrong, the issue is in `release-plan.yaml` or the release process—not this file.

### Do not create this file manually

Only automation creates this file. It does not belong on `main` or in manual commits.

### Do not rely on it before draft creation

During snapshot review (before Release PR merge), some fields may be incomplete (e.g., `release_date` is null). The file is fully populated at draft creation time.

---

## Relationship to `release-plan.yaml`

| Aspect | `release-plan.yaml` | `release-metadata.yaml` |
|--------|---------------------|------------------------|
| Purpose | Declares intent | Records reality |
| Location | `main` branch | Snapshot branch / tag |
| Edited by | Codeowners | Automation |
| Contains | Target values | Actual values |
| Version extensions | Not included | Calculated |
| Dependency versions | Release tags only | Tags + resolved versions |

Think of the plan as input and the metadata as output.
